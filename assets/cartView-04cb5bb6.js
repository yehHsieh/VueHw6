import{_ as P,m as I,b as V,S as L,r as m,o as n,c as l,e as u,g as i,d as t,x as y,y as D,F as p,v as x,z as b,t as c,w as C,A as T}from"./index-8da2a632.js";import{c as k}from"./cart-ca6ddce2.js";const{VITE_APP_URL:_,VITE_APP_PATH:h}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"barproject",VITE_TEXT:"…",BASE_URL:"/VueSideProject/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},A={data(){return{products:[],productId:"",cart:{},loadingItem:"",user:{},couponCode:"",allDiscount:!1,couponOn:!1,isLoading:!1}},computed:{...I(k,["num","carts","total","final_total","originPrice"])},methods:{...V(k,["getCart","deleteItem"]),getProducts(e){this.loadingItem=e,this.isLoading=!0,this.$http.get(`${_}/v2/api/${h}/products/all`).then(o=>{console.log("產品列表:",o.data.products),this.products=o.data.products,this.loadingItem="",this.isLoading=!1})},updateCartItem(e){const o={product_id:e.product.id,qty:e.qty};console.log(o,e.id),this.loadingItem=e.id,this.$http.put(`${_}/v2/api/${h}/cart/${e.id}`,{data:o}).then(g=>{console.log("更新購物車:",g.data),this.getCart(),this.loadingItem=""})},getCoupon(){if(this.couponCode==="drunk")this.allDiscount=!0;else{const e={code:this.couponCode};this.$http.post(`${_}v2/api/${h}/coupon`,{data:e}).then(o=>{console.log(o),this.couponOn=!0,this.getCart(),L.fire({icon:"success",title:o.data.message,showConfirmButton:!1,timer:1700})}).catch(o=>{console.log(o)})}}},mounted(){this.getProducts(),this.getCart()}},E=t("ul",{class:"progresses m-0 d-flex"},[t("li",{class:"active"},"商品確認"),t("li",null,"訂購人資訊"),t("li",null,"訂單完成")],-1),S={class:"container my-5 p-3 bg-secondary"},w={class:"d-flex justify-content-between"},R=t("h2",null,"商品確認",-1),O={class:"d-flex justify-content-between"},U={class:"table align-middle"},q=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"120px"}},"數量/單位"),t("th",null,"單價"),t("th",{class:"text-end"},"金額")])],-1),B=["onClick","disabled"],j=t("i",{class:"fas fa-spinner fa-pulse"},null,-1),N={class:"input-group input-group-sm"},M=["onUpdate:modelValue","onChange","disabled"],$=["value"],z={key:0},F={key:1},H={key:2,class:"text-end"},X=t("small",{class:"text-success"},"價格：",-1),G={key:3,class:"text-end"},J=t("small",{class:"text-success"},"價格：",-1),K={key:0},Q=t("td",{colspan:"4",class:"text-end"},"折扣金額:",-1),W={class:"text-end"},Y={key:1},Z=t("td",{colspan:"4",class:"text-end"},"折扣金額:",-1),tt={class:"text-end"},et={key:2},st={key:3},ot=t("td",{colspan:"4",class:"text-end text-success"},"最後金額:",-1),nt={class:"text-end text-success"},lt={key:4},ct=t("td",{colspan:"4",class:"text-end text-success"},"最後金額:",-1),dt={class:"text-end text-success"},it={colspan:"5",class:"text-end"};function at(e,o,g,rt,d,r){const v=m("Loading"),f=m("RouterLink");return n(),l(p,null,[u(v,{active:d.isLoading,"z-index":1060},null,8,["active"]),i(" 這是購物車頁面 "),E,t("div",S,[t("div",w,[R,t("div",O,[y(t("input",{type:"text",class:"me-3 rounded-pill","onUpdate:modelValue":o[0]||(o[0]=s=>d.couponCode=s),placeholder:"請輸入優惠碼"},null,512),[[D,d.couponCode,void 0,{trim:!0}]]),t("button",{class:"btn btn-outline-primary rounded-pill py-1 px-4 text-center",onClick:o[1]||(o[1]=(...s)=>r.getCoupon&&r.getCoupon(...s))},"驗證優惠碼")])]),t("table",U,[q,t("tbody",null,[e.carts?(n(!0),l(p,{key:0},x(e.carts,s=>(n(),l("tr",{key:s.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:a=>e.deleteItem(s),disabled:s.id===d.loadingItem},[j,i(" x ")],8,B)]),t("td",null,c(s.product.title),1),t("td",null,[t("div",N,[y(t("select",{class:"form-control",name:"",id:"","onUpdate:modelValue":a=>s.qty=a,onChange:a=>r.updateCartItem(s),disabled:s.id===d.loadingItem},[(n(),l(p,null,x(20,a=>t("option",{value:a,key:`${a}1223`},c(a)+"份",9,$)),64))],40,M),[[T,s.qty]])])]),d.allDiscount?(n(),l("td",z,[t("del",null,c(s.product.origin_price),1),i(" "+c(s.product.price),1)])):(n(),l("td",F,c(s.product.origin_price),1)),d.allDiscount?(n(),l("td",H,[X,i(" "+c(s.total),1)])):(n(),l("td",G,[J,i(" "+c(s.product.origin_price*s.qty),1)]))]))),128)):b("",!0)]),t("tfoot",null,[d.couponOn?(n(),l("tr",K,[Q,t("td",W,c(e.total-e.final_total),1)])):b("",!0),d.allDiscount?(n(),l("tr",Y,[Z,t("td",tt,c(e.originPrice-e.total),1)])):(n(),l("tr",et)),d.couponOn||d.allDiscount?(n(),l("tr",st,[ot,t("td",nt,c(e.final_total),1)])):(n(),l("tr",lt,[ct,t("td",dt,c(e.originPrice),1)])),t("tr",null,[t("td",it,[u(f,{to:"/AllProducts",class:"btn btn-outline-dark me-3 rounded-pill py-1 px-4 text-center"},{default:C(()=>[i("再逛逛")]),_:1}),u(f,{to:"/info",class:"btn btn-primary rounded-pill py-1 px-4 text-center"},{default:C(()=>[i("去結帳 ")]),_:1})])])])])]),i(" "+c(e.originPrice),1)],64)}const _t=P(A,[["render",at]]);export{_t as default};
